<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Referto Istologico Placenta</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f7fa;
            padding: 20px;
            color: #333;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 { font-size: 26px; margin-bottom: 8px; }
        .header p { font-size: 13px; opacity: 0.9; }
        .content {
            padding: 30px;
        }
        .section {
            margin-bottom: 25px;
            padding: 20px;
            background: #f9fafc;
            border-left: 5px solid #3498db;
            border-radius: 6px;
        }
        .section-title {
            font-size: 16px;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 15px;
        }
        .field-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }
        .field-group.full { grid-template-columns: 1fr; }
        .field {
            display: flex;
            flex-direction: column;
        }
        label {
            font-weight: 600;
            color: #555;
            margin-bottom: 6px;
            font-size: 13px;
        }
        input, select, textarea {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 13px;
            font-family: inherit;
        }
        textarea { resize: vertical; min-height: 80px; }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        .lesion-section {
            background: white;
            border: 2px solid #ecf0f1;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 6px;
            display: none;
        }
        .lesion-section.active {
            display: block;
            border-color: #e74c3c;
            background: #fdeaea;
        }
        .lesion-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            margin-bottom: 10px;
        }
        .lesion-toggle input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        .lesion-toggle label {
            margin: 0;
            font-size: 14px;
            cursor: pointer;
        }
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 30px;
        }
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .btn-primary {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            flex: 1;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(44, 62, 80, 0.3);
        }
        .btn-reset {
            background: #ecf0f1;
            color: #555;
        }
        .btn-reset:hover {
            background: #bdc3c7;
        }
        .result {
            display: none;
            background: #fff;
            border: 2px solid #2c3e50;
            border-radius: 8px;
            padding: 25px;
            margin-top: 30px;
            font-size: 14px;
            line-height: 1.8;
        }
        .result.active {
            display: block;
            animation: slideIn 0.4s ease;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .result-header {
            font-weight: 700;
            font-size: 16px;
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #ecf0f1;
        }
        .result-section {
            margin-bottom: 20px;
            padding: 12px;
            background: #f5f7fa;
            border-radius: 5px;
            border-left: 4px solid #3498db;
        }
        .result-section-title {
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 13px;
        }
        .result-content {
            color: #555;
            font-size: 13px;
            line-height: 1.6;
        }
        .status-yes { color: #27ae60; font-weight: 700; }
        .status-no { color: #e74c3c; font-weight: 700; }
        .status-partial { color: #f39c12; font-weight: 700; }
        .conclusione-box {
            background: #fef9e7;
            border-left: 4px solid #f39c12;
            padding: 15px;
            margin-top: 20px;
            border-radius: 5px;
            line-height: 1.8;
        }
        .workup-list { margin-left: 20px; margin-top: 10px; }
        .workup-list li { margin-bottom: 5px; list-style-type: disc; }
        .footer {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            text-align: center;
            font-size: 11px;
            line-height: 1.6;
            border-top: 1px solid #34495e;
            margin-top: 40px;
        }
        .footer a {
            color: #3498db;
            text-decoration: none;
        }
        .footer a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìã Esame Macro- e Microscopico della Placenta</h1>
            <p>Macroscopico ‚Ä¢ Pilastri ‚Ä¢ Lesioni patologiche ‚Ä¢ Conclusioni specifiche</p>
        </div>
        
        <div class="content">
            <form id="placentaForm">
                <!-- MACROSCOPICO -->
                <div class="section">
                    <div class="section-title">üîç MACROSCOPICO</div>
                    
                    <div class="field-group">
                    <div class="field-group">
                        <div class="field">
                            <label>EGA - Settimane</label>
                            <input type="number" id="ega_clinica_sett" min="16" max="42" value="40" required oninput="checkPeso()">
                        </div>
                        <div class="field">
                            <label>EGA - Giorni (0-6)</label>
                            <input type="number" id="ega_clinica_giorni" min="0" max="6" value="0" oninput="checkPeso()">
                        </div>
                    </div>
                        <div class="field">
                            <label>Peso placenta (g)</label>
                            <input type="number" id="peso_placenta" min="100" max="1000" value="500" oninput="checkPeso()">
                            <div id="peso_alert" style="margin-top: 8px; padding: 8px; border-radius: 4px; font-size: 12px; font-weight: 600; display: none;"></div>
                        </div>
                    </div>

                    <div class="field-group">
                        <div class="field">
                            <label>Spessore (mm)</label>
                            <input type="number" id="spessore" min="10" max="60" step="1" value="25" oninput="checkSpessore()">
                            <div id="spessore_alert" style="margin-top: 8px; padding: 8px; border-radius: 4px; font-size: 12px; font-weight: 600; display: none;"></div>
                        </div>
                        </div>
                        <div class="field">
                            <label>Lunghezza cordone (cm)</label>
                            <input type="number" id="lunghezza_cordone" min="10" max="100" value="50" oninput="checkCordone()">
                            <div id="cordone_alert" style="margin-top: 8px; padding: 8px; border-radius: 4px; font-size: 12px; font-weight: 600; display: none;"></div>
                        </div>
                    </div>

                    <div class="field-group">
                        <div class="field">
                            <label>Aspetto superficie fetale della placenta</label>
                            <select id="aspetto_fetale" required>
                                <option value="">Seleziona...</option>
                                <option value="Normale (lucido)">Normale (lucido)</option>
                                <option value="Opaco">Opaco</option>
                                <option value="Furfureo">Furfureo</option>
                                <option value="Nodulare">Nodulare</option>
                            </select>
                        </div>
                        <div class="field">
                            <label>Colore placenta</label>
                            <select id="colore_placenta" required>
                                <option value="">Seleziona...</option>
                                <option value="Rosso (normale)">Rosso (normale)</option>
                                <option value="Pallido">Pallido</option>
                                <option value="Scuro/marrone">Scuro/marrone</option>
                                <option value="Giallastro">Giallastro</option>
                            </select>
                        </div>
                    </div>

                    <div class="field-group full">
                        <div class="field">
                            <label>Aspetto cordone ombelicale</label>
                            <select id="aspetto_cordone" required>
                                <option value="">Seleziona...</option>
                                <option value="Normale (turgido, 3 vasi)">Normale (turgido, 3 vasi)</option>
                                <option value="Villoso">Villoso</option>
                                <option value="Edematoso">Edematoso</option>
                                <option value="Con trombosi">Con trombosi</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- PILASTRI FONDAMENTALI -->
                <div class="section">
                    <div class="section-title">üîç ESAME MICROSCOPICO - PILASTRI FONDAMENTALI</div>
                    
                    <div class="field-group">
                        <div class="field">
                            <label>EGA all'istologia</label>
                            <select id="ega_istologia" required>
                                <option value="">Seleziona...</option>
                                <option value="compatibile">Compatibile con l'EGA clinica</option>
                                <option value="precoce">Pi√π precoce del previsto</option>
                                <option value="tardiva">Pi√π tardiva del previsto</option>
                            </select>
                        </div>
                    </div>

                    <div class="field-group full">
                        <div class="field">
                            <label>Maturazione villare</label>
                            <select id="villi_stato" required>
                                <option value="">Seleziona...</option>
                                <option value="maturi">Maturi (sincizio sottile, fenestrazioni, nuclei marginali)</option>
                                <option value="intermedi">Intermedi (mix immaturi-maturi)</option>
                                <option value="immaturi">Immaturi (Langhans prominenti)</option>
                                <option value="degenerativi">Degenerativi (edema, sinciziale necrotico)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- LESIONE 1: INFARTI -->
                <div class="section">
                    <div class="section-title">üî¥ LESIONE 1: INFARTI PLACENTARI</div>
                    <div class="lesion-toggle">
                        <input type="checkbox" id="infarti_presenti" onchange="toggleInfarti()">
                        <label for="infarti_presenti"><strong>Infarti placentari presenti</strong></label>
                    </div>

                    <div id="infarti_dettagli" class="lesion-section">
                        <div class="field-group">
                            <div class="field">
                                <label>Estensione</label>
                                <select id="infarti_estensione" required>
                                    <option value="">Seleziona...</option>
                                    <option value="Focale">Focale (1-2 aree limitate)</option>
                                    <option value="Multifocale">Multifocale (3+ aree)</option>
                                    <option value="Estesa">Estesa (coinvolge &gt;25% parenchima)</option>
                                </select>
                            </div>
                            <div class="field">
                                <label>Localizzazione</label>
                                <select id="infarti_localizzazione" required>
                                    <option value="">Seleziona...</option>
                                    <option value="Periferica">Periferica</option>
                                    <option value="Centrale">Centrale</option>
                                    <option value="Diffusa">Diffusa</option>
                                </select>
                            </div>
                        </div>
                        <div class="field-group full">
                            <div class="field">
                                <label>% parenchima (stima)</label>
                                <input type="number" id="infarti_percentuale" min="0" max="100" step="5" value="10">
                            </div>
                        </div>
                        <div class="field-group full">
                            <div class="field">
                                <label>Note</label>
                                <textarea id="infarti_note" placeholder="Es. Infarti con bordo di flogosi cronica..."></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- LESIONE 2: VILLITE -->
                <div class="section">
                    <div class="section-title">üü° LESIONE 2: VILLITE</div>
                    <div class="lesion-toggle">
                        <input type="checkbox" id="villite_presenti" onchange="toggleVillite()">
                        <label for="villite_presenti"><strong>Villite presente</strong></label>
                    </div>

                    <div id="villite_dettagli" class="lesion-section">
                        <div class="field-group">
                            <div class="field">
                                <label>Grado</label>
                                <select id="villite_grado" required>
                                    <option value="">Seleziona...</option>
                                    <option value="Lieve">Lieve (infiltrato linfocitario focale)</option>
                                    <option value="Moderata">Moderata (infiltrato multifocale)</option>
                                    <option value="Severa">Severa (esteso, compromette villi)</option>
                                </select>
                            </div>
                            <div class="field">
                                <label>Distribuzione</label>
                                <select id="villite_distribuzione" required>
                                    <option value="">Seleziona...</option>
                                    <option value="Focale">Focale (aree limitate)</option>
                                    <option value="Multifocale">Multifocale</option>
                                    <option value="Diffusa">Diffusa (tutte le zone)</option>
                                </select>
                            </div>
                        </div>
                        <div class="field-group full">
                            <div class="field">
                                <label>Tipo infiltrato</label>
                                <select id="villite_tipo">
                                    <option value="Non specifico">Non specifico</option>
                                    <option value="Linfocitario">Prevalentemente linfocitario</option>
                                    <option value="Plasmatico">Prevalentemente plasmatico</option>
                                    <option value="Misto">Misto linfo-plasmatico</option>
                                    <option value="Granulocitario">Con componente granulocitaria</option>
                                </select>
                            </div>
                        </div>
                        <div class="field-group full">
                            <div class="field">
                                <label>Sospetto eziologico</label>
                                <textarea id="villite_note" placeholder="Es. Villite linfocitica diffusa, suggestiva di infezione congenita..."></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- LESIONE 3: CALCIFICAZIONI -->
                <div class="section">
                    <div class="section-title">üü¢ LESIONE 3: CALCIFICAZIONI</div>
                    <div class="lesion-toggle">
                        <input type="checkbox" id="calcif_presenti" onchange="toggleCalcif()">
                        <label for="calcif_presenti"><strong>Calcificazioni presenti</strong></label>
                    </div>

                    <div id="calcif_dettagli" class="lesion-section">
                        <div class="field-group">
                            <div class="field">
                                <label>Distribuzione</label>
                                <select id="calcif_distribuzione" required>
                                    <option value="">Seleziona...</option>
                                    <option value="Periferica">Periferica (margini placentari)</option>
                                    <option value="Centrale">Centrale</option>
                                    <option value="Diffusa">Diffusa (tutte le zone)</option>
                                </select>
                            </div>
                            <div class="field">
                                <label>Stadio</label>
                                <select id="calcif_stadio" required>
                                    <option value="">Seleziona...</option>
                                    <option value="Scarsa">Scarsa (fisiologica)</option>
                                    <option value="Moderata">Moderata (patologica)</option>
                                    <option value="Diffusa">Diffusa e marcata</option>
                                </select>
                            </div>
                        </div>
                        <div class="field-group full">
                            <div class="field">
                                <label>Aspetto microscopico</label>
                                <select id="calcif_aspetto">
                                    <option value="Non specificato">Non specificato</option>
                                    <option value="Sparse, fini">Sparse, fini (early)</option>
                                    <option value="Depositi solidi">Depositi solidi (mature)</option>
                                    <option value="Massivi">Massivi e confluenti</option>
                                </select>
                            </div>
                        </div>
                        <div class="field-group full">
                            <div class="field">
                                <label>Interpretazione clinica</label>
                                <textarea id="calcif_note" placeholder="Es. Calcificazioni diffuse a termine = marker di stress placentare cronico..."></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- NOTE AGGIUNTIVE -->
                <div class="section">
                    <div class="section-title">üìù NOTE AGGIUNTIVE</div>
                    <div class="field-group full">
                        <div class="field">
                            <label>Altre osservazioni</label>
                            <textarea id="note_aggiuntive" placeholder="Es. Corioamnionite, amniotite, emorragia, edema..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- BOTTONI -->
                <div class="button-group">
                    <button type="button" class="btn-primary" onclick="genera_referto()">üìÑ GENERA REFERTO</button>
                    <button type="reset" class="btn-reset">RESET</button>
                </div>
            </form>

            <!-- RISULTATO -->
            <div id="result" class="result">
                <div class="result-header">REFERTO ISTOLOGICO - PLACENTA</div>

                <div class="result-section">
                    <div class="result-section-title">MACROSCOPICO</div>
                    <div class="result-content" id="macro_output"></div>
                </div>

                <div class="result-section">
                    <div class="result-section-title">PILASTRI FONDAMENTALI</div>
                    <div class="result-content" id="pilastri_output"></div>
                </div>

                <div class="result-section">
                    <div class="result-section-title">üî¥ INFARTI PLACENTARI</div>
                    <div class="result-content" id="infarti_output"></div>
                </div>

                <div class="result-section">
                    <div class="result-section-title">üü° VILLITE</div>
                    <div class="result-content" id="villite_output"></div>
                </div>

                <div class="result-section">
                    <div class="result-section-title">üü¢ CALCIFICAZIONI</div>
                    <div class="result-content" id="calcif_output"></div>
                </div>

                <div class="result-section" id="note_aggiuntive_result" style="display: none;">
                    <div class="result-section-title">ALTRE OSSERVAZIONI</div>
                    <div class="result-content" id="note_aggiuntive_output"></div>
                </div>

                <div class="conclusione-box">
                    <div style="font-weight: 700; color: #2c3e50; margin-bottom: 10px;">CONCLUSIONE E INDICAZIONI CLINICHE:</div>
                    <div id="conclusione" style="color: #555; line-height: 1.8;"></div>
                </div>
            </div>
        </div>

        <div class="footer">
            <strong>RIFERIMENTI BIBLIOGRAFICI</strong><br>
            1. <a href="https://www.pregnancyhypertension.org/" target="_blank">ISSHP</a> - International Society for the Study of Hypertension in Pregnancy. Criteria for insufficienza placentare e preeclampsia.<br>
            2. <a href="https://pubmed.ncbi.nlm.nih.gov/" target="_blank">Benirschke & Kaufmann's Pathology of the Human Placenta</a> - Gold standard per istologia placentare e classificazione lesioni.<br>
            3. <a href="https://www.sipatologia.it/" target="_blank">SIPat</a> - Societ√† Italiana di Anatomia Patologica. Linee guida italiane per refertazione placentare.
        </div>
    </div>

    <script>
        function checkSpessore() {
            const spessore = parseInt(document.getElementById('spessore').value);
            const alert_div = document.getElementById('spessore_alert');
            
            if (spessore < 10) {
                alert_div.style.display = 'block';
                alert_div.style.background = '#f8d7da';
                alert_div.style.color = '#721c24';
                alert_div.style.borderLeft = '3px solid #721c24';
                alert_div.innerHTML = 'üî¥ ATROFIA - Possibile insufficienza placentare';
            } else if (spessore > 30) {
                alert_div.style.display = 'block';
                alert_div.style.background = '#fff3cd';
                alert_div.style.color = '#856404';
                alert_div.style.borderLeft = '3px solid #856404';
                alert_div.innerHTML = '‚ö†Ô∏è EDEMA - Possibile sofferenza placentare';
            } else {
                alert_div.style.display = 'block';
                alert_div.style.background = '#d4edda';
                alert_div.style.color = '#155724';
                alert_div.style.borderLeft = '3px solid #155724';
                alert_div.innerHTML = '‚úì NORMALE (10-30 mm)';
            }
        }

        function checkPeso() {
            const ega = parseInt(document.getElementById('ega_clinica_sett').value);
            const peso = parseInt(document.getElementById('peso_placenta').value);
            const pesoAtteso = ega * 15 - 200;
            const percentuale = Math.round((peso / pesoAtteso) * 100);
            const alert_div = document.getElementById('peso_alert');
            
            if (percentuale < 80) {
                alert_div.style.display = 'block';
                alert_div.style.background = '#f8d7da';
                alert_div.style.color = '#721c24';
                alert_div.style.borderLeft = '3px solid #721c24';
                alert_div.innerHTML = `üî¥ RIDOTTO - ${percentuale}% del peso atteso (${pesoAtteso}g)`;
            } else if (percentuale > 120) {
                alert_div.style.display = 'block';
                alert_div.style.background = '#fff3cd';
                alert_div.style.color = '#856404';
                alert_div.style.borderLeft = '3px solid #856404';
                alert_div.innerHTML = `‚ö†Ô∏è AUMENTATO - ${percentuale}% del peso atteso (${pesoAtteso}g)`;
            } else {
                alert_div.style.display = 'block';
                alert_div.style.background = '#d4edda';
                alert_div.style.color = '#155724';
                alert_div.style.borderLeft = '3px solid #155724';
                alert_div.innerHTML = `‚úì NORMALE - ${percentuale}% del peso atteso (${pesoAtteso}g)`;
            }
        }

        function checkCordone() {
            const cordone = parseInt(document.getElementById('lunghezza_cordone').value);
            const alert_div = document.getElementById('cordone_alert');
            
            if (cordone < 30) {
                alert_div.style.display = 'block';
                alert_div.style.background = '#f8d7da';
                alert_div.style.color = '#721c24';
                alert_div.style.borderLeft = '3px solid #721c24';
                alert_div.innerHTML = 'üî¥ CORTO - Rischio compressione/avvolgimento';
            } else if (cordone > 80) {
                alert_div.style.display = 'block';
                alert_div.style.background = '#fff3cd';
                alert_div.style.color = '#856404';
                alert_div.style.borderLeft = '3px solid #856404';
                alert_div.innerHTML = '‚ö†Ô∏è LUNGO - Rischio annodamento/volvolo';
            } else {
                alert_div.style.display = 'block';
                alert_div.style.background = '#d4edda';
                alert_div.style.color = '#155724';
                alert_div.style.borderLeft = '3px solid #155724';
                alert_div.innerHTML = '‚úì NORMALE (30-80 cm)';
            }
        }

        function toggleInfarti() {
            const ch = document.getElementById('infarti_presenti').checked;
            document.getElementById('infarti_dettagli').classList.toggle('active', ch);
        }

        function toggleVillite() {
            const ch = document.getElementById('villite_presenti').checked;
            document.getElementById('villite_dettagli').classList.toggle('active', ch);
        }

        function toggleCalcif() {
            const ch = document.getElementById('calcif_presenti').checked;
            document.getElementById('calcif_dettagli').classList.toggle('active', ch);
        }

        function genera_referto() {
            try {
                const ega_clinica = parseInt(document.getElementById('ega_clinica').value);
                const peso_placenta = document.getElementById('peso_placenta').value;
                const spessore = document.getElementById('spessore').value;
                const lunghezza_cordone = document.getElementById('lunghezza_cordone').value;
                const aspetto_fetale = document.getElementById('aspetto_fetale').value;
                const colore_placenta = document.getElementById('colore_placenta').value;
                const aspetto_cordone = document.getElementById('aspetto_cordone').value;

                const ega_istologia = document.getElementById('ega_istologia').value;
                const villi_stato = document.getElementById('villi_stato').value;

                // MACROSCOPICO
                document.getElementById('macro_output').innerHTML = `
                    <strong>EGA:</strong> ${ega_clinica} settimane<br>
                    <strong>Peso:</strong> ${peso_placenta}g<br>
                    <strong>Spessore:</strong> ${spessore} mm<br>
                    <strong>Lunghezza cordone:</strong> ${lunghezza_cordone} cm<br>
                    <strong>Superficie fetale:</strong> ${aspetto_fetale}<br>
                    <strong>Colore:</strong> ${colore_placenta}<br>
                    <strong>Cordone ombelicale:</strong> ${aspetto_cordone}
                `;

                // PILASTRI
                let pilastri_html = '';
                if (ega_istologia === 'compatibile') {
                    pilastri_html += `<strong>‚úì ETA' GESTAZIONALE:</strong> <span class="status-yes">Compatibile</span> con EGA clinica ${ega_clinica} settimane.<br>`;
                } else if (ega_istologia === 'precoce') {
                    pilastri_html += `<strong>‚ö† ETA' GESTAZIONALE:</strong> <span class="status-partial">Pi√π precoce</span> di quella indicata.<br>`;
                } else if (ega_istologia === 'tardiva') {
                    pilastri_html += `<strong>‚ö† ETA' GESTAZIONALE:</strong> <span class="status-partial">Pi√π tardiva</span> di quella indicata.<br>`;
                }

                if (villi_stato === 'maturi') {
                    pilastri_html += `<strong>‚úì VILLI CORIALI:</strong> <span class="status-yes">Maturi</span> - sincizio sottile, fenestrazioni, nuclei marginali.`;
                } else if (villi_stato === 'intermedi') {
                    pilastri_html += `<strong>‚ö† VILLI CORIALI:</strong> <span class="status-partial">Intermedi</span> - maturazione parziale.`;
                } else if (villi_stato === 'immaturi') {
                    pilastri_html += `<strong>‚úó VILLI CORIALI:</strong> <span class="status-no">Immaturi</span> - A ${ega_clinica} settimane = ANOMALO.`;
                } else if (villi_stato === 'degenerativi') {
                    pilastri_html += `<strong>‚úó VILLI CORIALI:</strong> <span class="status-no">Degenerativi</span> - Edema, sinciziale necrotico.`;
                }

                document.getElementById('pilastri_output').innerHTML = pilastri_html;

                // INFARTI
                let infarti_presente = document.getElementById('infarti_presenti').checked;
                if (infarti_presente) {
                    const estensione = document.getElementById('infarti_estensione').value;
                    const localizzazione = document.getElementById('infarti_localizzazione').value;
                    const percentuale = document.getElementById('infarti_percentuale').value;
                    const note = document.getElementById('infarti_note').value;
                    document.getElementById('infarti_output').innerHTML = `<span class="status-no">PRESENTI</span><br><strong>Estensione:</strong> ${estensione}<br><strong>Localizzazione:</strong> ${localizzazione}<br><strong>% parenchima:</strong> ~${percentuale}%<br>${note ? '<strong>Note:</strong> ' + note : ''}`;
                } else {
                    document.getElementById('infarti_output').innerHTML = `<span class="status-yes">ASSENTI</span>`;
                }

                // VILLITE
                let villite_presente = document.getElementById('villite_presenti').checked;
                if (villite_presente) {
                    const grado = document.getElementById('villite_grado').value;
                    const distribuzione = document.getElementById('villite_distribuzione').value;
                    const tipo = document.getElementById('villite_tipo').value;
                    const note = document.getElementById('villite_note').value;
                    document.getElementById('villite_output').innerHTML = `<span class="status-no">PRESENTE</span><br><strong>Grado:</strong> ${grado}<br><strong>Distribuzione:</strong> ${distribuzione}<br><strong>Infiltrato:</strong> ${tipo}<br>${note ? '<strong>Interpretazione:</strong> ' + note : ''}`;
                } else {
                    document.getElementById('villite_output').innerHTML = `<span class="status-yes">ASSENTE</span>`;
                }

                // CALCIFICAZIONI
                let calcif_presente = document.getElementById('calcif_presenti').checked;
                let calcif_patologica = false;
                if (calcif_presente) {
                    const distribuzione = document.getElementById('calcif_distribuzione').value;
                    const stadio = document.getElementById('calcif_stadio').value;
                    const aspetto = document.getElementById('calcif_aspetto').value;
                    const note = document.getElementById('calcif_note').value;
                    calcif_patologica = (stadio !== 'Scarsa');
                    const status = stadio === 'Scarsa' ? 'status-yes' : 'status-partial';
                    const label = stadio === 'Scarsa' ? 'SCARSE (fisiologiche)' : 'PRESENTI';
                    document.getElementById('calcif_output').innerHTML = `<span class="${status}">${label}</span><br><strong>Distribuzione:</strong> ${distribuzione}<br><strong>Stadio:</strong> ${stadio}<br><strong>Aspetto:</strong> ${aspetto}<br>${note ? '<strong>Interpretazione:</strong> ' + note : ''}`;
                } else {
                    document.getElementById('calcif_output').innerHTML = `<span class="status-yes">ASSENTI</span>`;
                }

                // NOTE AGGIUNTIVE
                const note_aggiuntive = document.getElementById('note_aggiuntive').value;
                if (note_aggiuntive) {
                    document.getElementById('note_aggiuntive_result').style.display = 'block';
                    document.getElementById('note_aggiuntive_output').innerHTML = note_aggiuntive;
                } else {
                    document.getElementById('note_aggiuntive_result').style.display = 'none';
                }

                // CONCLUSIONE
                let conclusione = '';
                const no_lesioni = !infarti_presente && !villite_presente && !calcif_presente;
                const solo_calcif_scarsa = !infarti_presente && !villite_presente && calcif_presente && !calcif_patologica;

                if (no_lesioni && villi_stato === 'maturi' && ega_istologia === 'compatibile') {
                    conclusione = `<strong>ESAME ISTOLOGICO SENZA ALTERAZIONI SIGNIFICATIVE</strong><br><br>
                        La placenta presenta struttura e maturazione istologica pienamente compatibile con l'EGA clinica indicata di ${ega_clinica} settimane. Villi coriali maturi con sinciziotrofoblasto sottile, fenestrazioni presenti e nuclei marginali ben rappresentati. Assenza di infarti, villiti o calcificazioni patologiche. Quadro istologico totalmente idoneo per gravidanza normotesa senza complicanze.<br><br>
                        <strong>Significato clinico:</strong> Questo pattern √® indicativo di adeguata funzione placentare e perfusione materno-fetale conservata. Non sussistono elementi patologici suggestivi di insufficienza placentare, infezione congenita o fattori trombotici.<br><br>
                        <strong>Raccomandazioni:</strong> Follow-up ostetrico e pediatrico standard secondo protocolli di routine. Nessun workup serologico o genetico aggiuntivo necessario.`;
                } else if (solo_calcif_scarsa && villi_stato === 'maturi') {
                    conclusione = `<strong>ESAME CON LIEVI ALTERAZIONI FISIOLOGICHE</strong><br><br>
                        Calcificazioni scarse e sporadiche, completamente compatibili con l'invecchiamento fisiologico della placenta a termine. Questo √® un reperto atteso nelle ultime settimane di gravidanza come conseguenza del normale metabolismo calcico e dell'apoptosi trofoblastica programmata. La struttura placentare √® altrimenti normale con villi maturi e assenza di lesioni significative.<br><br>
                        <strong>Significato clinico:</strong> Le calcificazioni scarse a termine non hanno significato patologico e non indicano sofferenza placentare. Rappresentano un marker naturale di maturazione placentare.<br><br>
                        <strong>Raccomandazioni:</strong> Follow-up clinico standard. Nessun approfondimento aggiuntivo necessario.`;
                } else if (infarti_presente && !villite_presente && !calcif_patologica) {
                    conclusione = `<strong>INSUFFICIENZA PLACENTARE CRONICA CON INFARTI PLACENTARI</strong><br><br>
                        Riscontrati infarti placentari multifocali/estesi, indicativi di insufficienza placentare cronica. Gli infarti rappresentano aree di necrosi villare da ischemia, spesso conseguenti a patologie vascolari materne (preeclampsia, ipertensione gestazionale) o a disordini trombotici. Questo pattern √® fortemente associato a restrizione di crescita intrauterina (IUGR), ipertensione gestazionale, preeclampsia e potenziali complicanze neonatali (basso peso, ipossia perinatale).<br><br>
                        <strong>Significato clinico:</strong> La presenza di infarti suggerisce compromissione della funzione placentare con ridotta area di scambio materno-fetale. Correlazione urgente con clinica (pressione materna, oligoidramnios, velocimetria doppler, peso fetale stimato).<br><br>
                        <strong>Workup consigliato:</strong>
                        <ul class="workup-list">
                            <li><strong>Trombofilgia materna:</strong> Fattore V Leiden (G1691A), Protrombina (G20210A), Proteina C, Proteina S, Antitrombina, omocisteina</li>
                            <li><strong>Anticorpi antifosfolipidi:</strong> APA (anticardiolipina, Œ≤2-glicoproteina), lupus anticoagulant</li>
                            <li><strong>Emocromo e coagulazione:</strong> Piastrine, LDH, D-dimero per escludere HELLP/DIC</li>
                            <li><strong>Counseling ostetrico:</strong> Alto rischio di ricorrenza in gravidanze future; valutare screening trombofilgia, terapia tromboprofilattica (EBPM/acido acetilsalicilico)</li>
                        </ul>`;
                } else if (!infarti_presente && villite_presente && !calcif_patologica) {
                    conclusione = `<strong>VILLITE - FORTEMENTE SOSPETTA INFEZIONE CONGENITA</strong><br><br>
                        Riscontrata infiammazione significativa dei villi coriali con infiltrato cellulare ${document.getElementById('villite_grado').value.toLowerCase()}, pattern istologico classicamente associato a infezioni intrauterine congenite. Le possibili eziologie includono: <strong>CMV (pi√π frequente)</strong>, tossoplasma, sifilide, listeria, virus varicella-zoster, epatite E, parvovirus B19. La villite riflette una risposta immunitaria fetale/placentare all'agente patogeno, con rischio significativo di trasmissione verticale e sequele neonatali (danno neurologico, ipossia, prematurit√†, basso peso).<br><br>
                        <strong>Significato clinico:</strong> URGENTE - Questo reperto richiede approfondimento serologico e molecolare immediato per identificare l'eziologia e stratificare il rischio neonatale. Le infezioni congenite hanno tassi di sequela del 10-25% (sordit√†, ritardo psicomotorio, retinopatia, epatosplenomegalia).<br><br>
                        <strong>Workup URGENTE consigliato:</strong>
                        <ul class="workup-list">
                            <li><strong>Serologica materna STAT:</strong> CMV IgG/IgM, Toxo IgG/IgM, RPR/TPPA (sifilide), listeria sierologia, varicella IgG/IgM, parvovirus IgG/IgM</li>
                            <li><strong>PCR liquor neonatale (ASAP):</strong> CMV, toxo, listeria, HSV-1/HSV-2, VZV se disponibili</li>
                            <li><strong>Istologia placentare aggiuntiva:</strong> Ricerca inclusioni citomegaliche, coloranti speciali (PAS, Giemsa) per identificare microrganismi</li>
                            <li><strong>Follow-up pediatrico urgente:</strong> Valutazione audiologica (per CMV/tossoplasma), oftalmologia (retinopatia), neurologia (anomalie sviluppo), imaging cerebrale se indicato</li>
                            <li><strong>Counseling genitoriale:</strong> Spiegare diagnosi presunta, possibili esiti, necessit√† di follow-up neonatale prolungato, trattamenti disponibili (ganciclovir per CMV neonatale, ecc.)</li>
                        </ul>`;
                } else if (!infarti_presente && !villite_presente && calcif_patologica) {
                    conclusione = `<strong>CALCIFICAZIONI PATOLOGICHE - MARKER DI STRESS PLACENTARE CRONICO</strong><br><br>
                        Riscontrate calcificazioni diffuse e patologicamente significative nei villi coriali, espressione di stress ossidativo cronico e invecchiamento placentare accelerato. Questo reperto √® frequentemente associato a condizioni di insufficienza placentare cronica, preeclampsia tardiva, ipertensione gestazionale e restrizione di crescita. Le calcificazioni rappresentano depositi di cristalli di calcio fosforico derivanti da danno trofoblastico cronico e apoptosi accelerata.<br><br>
                        <strong>Significato clinico:</strong> Marker di compromissione funzionale placentare, sebbene meno specifico degli infarti. Spesso correla con outcome perinatale sfavorevole (basso peso, ipossia, prematurit√†). Richiede correlazione con clinica ostetrica (pressione, proteinuria, ecografia ostetricia con Doppler).<br><br>
                        <strong>Workup consigliato:</strong>
                        <ul class="workup-list">
                            <li><strong>Correlazione clinica ostetrica:</strong> Valutare presenza di preeclampsia, ipertensione gestazionale, ritardo di crescita stimato all'ecografia</li>
                            <li><strong>Screening trombofilgia materna:</strong> Se storia di preeclampsia ricorrente, perdite ripetute o trombosi (fattore V Leiden, G20210A, proteina C/S)</li>
                            <li><strong>Anticorpi antifosfolipidi:</strong> Se preeclampsia precoce (&lt;34 sett) o storia di perdita ricorrente</li>
                            <li><strong>Follow-up neonatale:</strong> Valutare outcome (peso, Apgar, complicanze respiratorie, neurologia)</li>
                            <li><strong>Counseling:</strong> Rischio moderato di ricorrenza in gravidanze future; valutare controllo BP, proteinuria, ecografia e Doppler ravvicinati</li>
                        </ul>`;
                } else {
                    conclusione = `<strong>ALTERAZIONI PATOLOGICHE MULTIPLE SIGNIFICATIVE - DANNO PLACENTARE SEVERO</strong><br><br>
                        Riscontrate alterazioni placentari importanti e multifenomenali: associazione di infarti, villite e/o calcificazioni patologiche. Questo pattern complesso suggerisce danno placentare da meccanismi multipli e sovrapposti: (1) insufficienza vascolare cronica con ischemica (infarti), (2) componente infiammatoria/infettiva (villite), (3) stress ossidativo accelerato (calcificazioni). Questo quadro √® indicativo di compromissione severa della funzione placentare con alto rischio di outcome perinatale sfavorevole.<br><br>
                        <strong>Significato clinico:</strong> URGENTE - Danno placentare multifattoriale con potenziale coinvolgimento di fattori sia materni (trombofilia, autoimmunit√†) che infettivi. Altissimo rischio di IUGR, ipossia perinatale, morte fetale e sequele neonatali (encefalopatia, sordit√†, disabilit√† neurologiche).<br><br>
                        <strong>Workup URGENTE e completo consigliato:</strong>
                        <ul class="workup-list">
                            <li><strong>Serologica materna STAT:</strong> CMV, toxo, sifilide, listeria, varicella (per escludere/confermare infezione congenita)</li>
                            <li><strong>Trombofilgia materna:</strong> Fattore V, G20210A, proteina C/S, antitrombina, omocisteina</li>
                            <li><strong>Anticorpi antifosfolipidi:</strong> APA, lupus anticoagulant (se preeclampsia precoce o perdite ricorrenti)</li>
                            <li><strong>PCR liquor e colture neonatali:</strong> Ricerca agenti infettivi, emocolture per batteriemia congenita</li>
                            <li><strong>Follow-up pediatrico URGENTE e multidisciplinare:</strong> Valutazione neurologica, audiologica, oftalmologica. Imaging cerebrale. Ricerca sequele infettive.</li>
                            <li><strong>Counseling genitoriale urgente:</strong> Discussione approfondita su rischi, outcome attesi, possibili complicanze, opzioni terapeutiche neonatali</li>
                            <li><strong>Valutazione post-partum:</strong> Follow-up neonatale prolungato (almeno 24 mesi per CMV/toxo), possibile trattamento (ganciclovir, spiramicina, ecc.)</li>
                        </ul>`;
                }

                document.getElementById('conclusione').innerHTML = conclusione;
                document.getElementById('result').classList.add('active');
                document.getElementById('result').scrollIntoView({ behavior: 'smooth', block: 'start' });
            } catch (error) {
                alert('Errore: ' + error.message);
                console.error(error);
            }
        }
    </script>
</body>
</html>
