<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Esame Istologico della Placenta</title>
    <style>
        :root {
            --bg: #f8f9fa;
            --bg-card: #ffffff;
            --border: #e8eaed;
            --border-subtle: #efefef;
            --accent: #2563eb;
            --accent-soft: rgba(37,99,235,0.08);
            --danger: #dc2626;
            --danger-soft: rgba(220,38,38,0.08);
            --warn: #d97706;
            --warn-soft: rgba(217,119,6,0.08);
            --ok: #16a34a;
            --ok-soft: rgba(22,163,74,0.08);
            --text-main: #1f2937;
            --text-muted: #6b7280;
            --chip-bg: #f3f4f6;
        }

        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", sans-serif;
            background: var(--bg);
            color: var(--text-main);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--bg-card);
            border-radius: 1rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, var(--accent), #1d4ed8);
            color: white;
            padding: 2.5rem;
            text-align: center;
        }

        .header h1 { 
            font-size: 1.75rem; 
            margin-bottom: 0.5rem;
            letter-spacing: 0.02em;
        }

        .header p { 
            font-size: 0.9rem; 
            opacity: 0.9;
        }

        .content {
            padding: 2rem;
        }

        .section {
            margin-bottom: 1.5rem;
            padding: 1.5rem;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 0.8rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .section-title {
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-muted);
            margin-bottom: 1rem;
            font-weight: 600;
        }

        .field-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 0.9rem 1.2rem;
            margin-bottom: 0.6rem;
        }

        .field-group.full { 
            grid-template-columns: 1fr; 
        }

        .field {
            display: flex;
            flex-direction: column;
            gap: 0.3rem;
        }

        label {
            font-weight: 500;
            color: var(--text-main);
            font-size: 0.8rem;
        }

        input, select, textarea {
            width: 100%;
            padding: 0.5rem 0.6rem;
            border: 1px solid var(--border);
            background: var(--bg-card);
            color: var(--text-main);
            font-size: 0.9rem;
            border-radius: 0.6rem;
            font-family: inherit;
            outline: none;
            transition: border-color 0.15s, box-shadow 0.15s;
        }

        textarea { 
            resize: vertical; 
            min-height: 80px;
        }

        input:focus, select:focus, textarea:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 2px var(--accent-soft);
        }

        .alert-box {
            margin-top: 0.6rem;
            padding: 0.6rem;
            border-radius: 0.4rem;
            font-size: 0.75rem;
            font-weight: 600;
            border-left: 3px solid;
        }

        .alert-ok {
            background: var(--ok-soft);
            color: var(--ok);
            border-left-color: var(--ok);
        }

        .alert-warn {
            background: var(--warn-soft);
            color: var(--warn);
            border-left-color: var(--warn);
        }

        .alert-danger {
            background: var(--danger-soft);
            color: var(--danger);
            border-left-color: var(--danger);
        }

        .lesion-section {
            background: var(--bg);
            border: 1px solid var(--border);
            padding: 1.2rem;
            margin-bottom: 1rem;
            border-radius: 0.6rem;
            display: none;
        }

        .lesion-section.active {
            display: block;
            border-color: var(--danger);
            background: var(--danger-soft);
        }

        .lesion-toggle {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            cursor: pointer;
            margin-bottom: 1rem;
        }

        .lesion-toggle input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .lesion-toggle label {
            margin: 0;
            font-size: 0.9rem;
            cursor: pointer;
            font-weight: 500;
        }

        .button-group {
            display: flex;
            gap: 0.8rem;
            margin-top: 2rem;
            flex-wrap: wrap;
        }

        button {
            padding: 0.65rem 1.3rem;
            border: none;
            border-radius: 0.7rem;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent), #1d4ed8);
            color: white;
            flex: 1;
            box-shadow: 0 2px 8px rgba(37,99,235,0.2);
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(37,99,235,0.3);
        }

        .btn-reset {
            background: var(--chip-bg);
            color: var(--text-main);
            border: 1px solid var(--border);
        }

        .btn-reset:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        .result {
            display: none;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 0.8rem;
            padding: 1.6rem;
            margin-top: 2rem;
            font-size: 0.85rem;
            line-height: 1.6;
        }

        .result.active {
            display: block;
            animation: slideIn 0.4s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .result-header {
            font-weight: 700;
            font-size: 0.95rem;
            color: var(--text-main);
            margin-bottom: 1.2rem;
            padding-bottom: 0.8rem;
            border-bottom: 2px solid var(--border);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .result-section {
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: var(--bg);
            border-radius: 0.6rem;
            border-left: 4px solid var(--accent);
        }

        .result-section-title {
            font-weight: 600;
            color: var(--text-main);
            margin-bottom: 0.6rem;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.08em;
        }

        .result-content {
            color: var(--text-main);
            font-size: 0.8rem;
            line-height: 1.6;
        }

        .status-yes { 
            color: var(--ok); 
            font-weight: 700; 
        }

        .status-no { 
            color: var(--danger); 
            font-weight: 700; 
        }

        .status-partial { 
            color: var(--warn); 
            font-weight: 700; 
        }

        .conclusione-box {
            background: var(--warn-soft);
            border-left: 4px solid var(--warn);
            padding: 1.2rem;
            margin-top: 1.5rem;
            border-radius: 0.6rem;
            line-height: 1.7;
            font-size: 0.85rem;
        }

        .workup-list { 
            margin-left: 1.5rem; 
            margin-top: 0.8rem; 
        }

        .workup-list li { 
            margin-bottom: 0.4rem; 
            list-style-type: disc;
            line-height: 1.6;
        }

        .footer {
            background: linear-gradient(135deg, #1f2937, #111827);
            color: #e5e7eb;
            padding: 1.5rem;
            text-align: center;
            font-size: 0.7rem;
            line-height: 1.6;
            border-top: 1px solid var(--border);
            margin-top: 3rem;
        }

        .footer a {
            color: var(--accent);
            text-decoration: none;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        @media (max-width: 700px) {
            .content {
                padding: 1rem;
            }
            
            .header {
                padding: 1.5rem;
            }

            .header h1 {
                font-size: 1.3rem;
            }

            .field-group {
                grid-template-columns: 1fr;
            }

            button {
                font-size: 0.8rem;
                padding: 0.5rem 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü´Ä Esame Istologico della Placenta</h1>
            <p>Macroscopico ‚Ä¢ Pilastri ‚Ä¢ Lesioni ‚Ä¢ Conclusioni specifiche</p>
        </div>
        
        <div class="content">
            <form id="placentaForm">
                <!-- MACROSCOPICO -->
                <div class="section">
                    <div class="section-title">üîç Macroscopico</div>
                    
                    <div class="field-group">
                        <div class="field">
                            <label>EGA - Settimane</label>
                            <input type="number" id="ega_clinica_sett" min="16" max="42" value="40" required oninput="checkPeso()">
                        </div>
                        <div class="field">
                            <label>EGA - Giorni (0-6)</label>
                            <input type="number" id="ega_clinica_giorni" min="0" max="6" value="0" oninput="checkPeso()">
                        </div>
                    </div>

                    <div class="field-group">
                        <div class="field">
                            <label>Peso placenta (g)</label>
                            <input type="number" id="peso_placenta" min="100" max="1000" value="500" oninput="checkPeso()">
                            <div id="peso_alert"></div>
                        </div>
                        <div class="field">
                            <label>Spessore (mm)</label>
                            <input type="number" id="spessore" min="10" max="60" step="1" value="25" oninput="checkSpessore()">
                            <div id="spessore_alert"></div>
                        </div>
                    </div>

                    <div class="field-group">
                        <div class="field">
                            <label>Lunghezza cordone (cm)</label>
                            <input type="number" id="lunghezza_cordone" min="10" max="100" value="50" oninput="checkCordone()">
                            <div id="cordone_alert"></div>
                        </div>
                    </div>

                    <div class="field-group">
                        <div class="field">
                            <label>Aspetto superficie fetale</label>
                            <select id="aspetto_fetale" required>
                                <option value="">Seleziona...</option>
                                <option value="Normale (lucido)">Normale (lucido)</option>
                                <option value="Opaco">Opaco</option>
                                <option value="Furfureo">Furfureo</option>
                                <option value="Nodulare">Nodulare</option>
                            </select>
                        </div>
                        <div class="field">
                            <label>Colore placenta</label>
                            <select id="colore_placenta" required>
                                <option value="">Seleziona...</option>
                                <option value="Rosso (normale)">Rosso (normale)</option>
                                <option value="Pallido">Pallido</option>
                                <option value="Scuro/marrone">Scuro/marrone</option>
                                <option value="Giallastro">Giallastro</option>
                            </select>
                        </div>
                    </div>

                    <div class="field-group full">
                        <div class="field">
                            <label>Aspetto cordone ombelicale</label>
                            <select id="aspetto_cordone" required>
                                <option value="">Seleziona...</option>
                                <option value="Normale (turgido, 3 vasi)">Normale (turgido, 3 vasi)</option>
                                <option value="Villoso">Villoso</option>
                                <option value="Edematoso">Edematoso</option>
                                <option value="Con trombosi">Con trombosi</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- PILASTRI FONDAMENTALI -->
                <div class="section">
                    <div class="section-title">üî¨ Pilastri Fondamentali</div>
                    
                    <div class="field-group">
                        <div class="field">
                            <label>EGA all'istologia</label>
                            <select id="ega_istologia" required>
                                <option value="">Seleziona...</option>
                                <option value="compatibile">Compatibile con l'EGA clinica</option>
                                <option value="precoce">Pi√π precoce del previsto</option>
                                <option value="tardiva">Pi√π tardiva del previsto</option>
                            </select>
                        </div>
                    </div>

                    <div class="field-group full">
                        <div class="field">
                            <label>Maturazione villare</label>
                            <select id="villi_stato" required>
                                <option value="">Seleziona...</option>
                                <option value="maturi">Maturi (sincizio sottile, fenestrazioni, nuclei marginali)</option>
                                <option value="intermedi">Intermedi (mix immaturi-maturi)</option>
                                <option value="immaturi">Immaturi (Langhans prominenti)</option>
                                <option value="degenerativi">Degenerativi (edema, sinciziale necrotico)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- INFARTI -->
                <div class="section">
                    <div class="section-title">üî¥ Lesione 1: Infarti Placentari</div>
                    <div class="lesion-toggle">
                        <input type="checkbox" id="infarti_presenti" onchange="toggleInfarti()">
                        <label for="infarti_presenti"><strong>Infarti placentari presenti</strong></label>
                    </div>

                    <div id="infarti_dettagli" class="lesion-section">
                        <div class="field-group">
                            <div class="field">
                                <label>Estensione</label>
                                <select id="infarti_estensione" required>
                                    <option value="">Seleziona...</option>
                                    <option value="Focale">Focale (1-2 aree limitate)</option>
                                    <option value="Multifocale">Multifocale (3+ aree)</option>
                                    <option value="Estesa">Estesa (>25% parenchima)</option>
                                </select>
                            </div>
                            <div class="field">
                                <label>Localizzazione</label>
                                <select id="infarti_localizzazione" required>
                                    <option value="">Seleziona...</option>
                                    <option value="Periferica">Periferica</option>
                                    <option value="Centrale">Centrale</option>
                                    <option value="Diffusa">Diffusa</option>
                                </select>
                            </div>
                        </div>
                        <div class="field-group full">
                            <div class="field">
                                <label>% parenchima coinvolto (stima)</label>
                                <input type="number" id="infarti_percentuale" min="0" max="100" step="5" value="10">
                            </div>
                        </div>
                        <div class="field-group full">
                            <div class="field">
                                <label>Note</label>
                                <textarea id="infarti_note" placeholder="Es. Infarti con bordo di flogosi cronica..."></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- VILLITE -->
                <div class="section">
                    <div class="section-title">üü° Lesione 2: Villite</div>
                    <div class="lesion-toggle">
                        <input type="checkbox" id="villite_presenti" onchange="toggleVillite()">
                        <label for="villite_presenti"><strong>Villite presente</strong></label>
                    </div>

                    <div id="villite_dettagli" class="lesion-section">
                        <div class="field-group">
                            <div class="field">
                                <label>Grado</label>
                                <select id="villite_grado" required>
                                    <option value="">Seleziona...</option>
                                    <option value="Lieve">Lieve (infiltrato linfocitario focale)</option>
                                    <option value="Moderata">Moderata (infiltrato multifocale)</option>
                                    <option value="Severa">Severa (esteso, compromette villi)</option>
                                </select>
                            </div>
                            <div class="field">
                                <label>Distribuzione</label>
                                <select id="villite_distribuzione" required>
                                    <option value="">Seleziona...</option>
                                    <option value="Focale">Focale</option>
                                    <option value="Multifocale">Multifocale</option>
                                    <option value="Diffusa">Diffusa</option>
                                </select>
                            </div>
                        </div>
                        <div class="field-group full">
                            <div class="field">
                                <label>Tipo infiltrato</label>
                                <select id="villite_tipo">
                                    <option value="Non specifico">Non specifico</option>
                                    <option value="Linfocitario">Prevalentemente linfocitario</option>
                                    <option value="Plasmatico">Prevalentemente plasmatico</option>
                                    <option value="Misto">Misto linfo-plasmatico</option>
                                    <option value="Granulocitario">Con componente granulocitaria</option>
                                </select>
                            </div>
                        </div>
                        <div class="field-group full">
                            <div class="field">
                                <label>Sospetto eziologico</label>
                                <textarea id="villite_note" placeholder="Es. Villite linfocitica diffusa, suggestiva di infezione congenita..."></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- CALCIFICAZIONI -->
                <div class="section">
                    <div class="section-title">üü¢ Lesione 3: Calcificazioni</div>
                    <div class="lesion-toggle">
                        <input type="checkbox" id="calcif_presenti" onchange="toggleCalcif()">
                        <label for="calcif_presenti"><strong>Calcificazioni presenti</strong></label>
                    </div>

                    <div id="calcif_dettagli" class="lesion-section">
                        <div class="field-group">
                            <div class="field">
                                <label>Distribuzione</label>
                                <select id="calcif_distribuzione" required>
                                    <option value="">Seleziona...</option>
                                    <option value="Periferica">Periferica (margini)</option>
                                    <option value="Centrale">Centrale</option>
                                    <option value="Diffusa">Diffusa</option>
                                </select>
                            </div>
                            <div class="field">
                                <label>Stadio</label>
                                <select id="calcif_stadio" required>
                                    <option value="">Seleziona...</option>
                                    <option value="Scarsa">Scarsa (fisiologica)</option>
                                    <option value="Moderata">Moderata (patologica)</option>
                                    <option value="Diffusa">Diffusa e marcata</option>
                                </select>
                            </div>
                        </div>
                        <div class="field-group full">
                            <div class="field">
                                <label>Aspetto microscopico</label>
                                <select id="calcif_aspetto">
                                    <option value="Non specificato">Non specificato</option>
                                    <option value="Sparse, fini">Sparse, fini</option>
                                    <option value="Depositi solidi">Depositi solidi</option>
                                    <option value="Massivi">Massivi e confluenti</option>
                                </select>
                            </div>
                        </div>
                        <div class="field-group full">
                            <div class="field">
                                <label>Interpretazione clinica</label>
                                <textarea id="calcif_note" placeholder="Es. Calcificazioni diffuse a termine = marker di stress placentare..."></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- NOTE AGGIUNTIVE -->
                <div class="section">
                    <div class="section-title">üìù Note Aggiuntive</div>
                    <div class="field-group full">
                        <div class="field">
                            <label>Altre osservazioni</label>
                            <textarea id="note_aggiuntive" placeholder="Es. Corioamnionite, amniotite, emorragia, edema..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- BOTTONI -->
                <div class="button-group">
                    <button type="button" class="btn-primary" onclick="genera_referto()">üìÑ Genera Referto</button>
                    <button type="reset" class="btn-reset">üîÑ Reset</button>
                </div>
            </form>

            <!-- RISULTATO -->
            <div id="result" class="result">
                <div class="result-header">Referto Istologico - Placenta</div>

                <div class="result-section">
                    <div class="result-section-title">Macroscopico</div>
                    <div class="result-content" id="macro_output"></div>
                </div>

                <div class="result-section">
                    <div class="result-section-title">Pilastri Fondamentali</div>
                    <div class="result-content" id="pilastri_output"></div>
                </div>

                <div class="result-section">
                    <div class="result-section-title">üî¥ Infarti Placentari</div>
                    <div class="result-content" id="infarti_output"></div>
                </div>

                <div class="result-section">
                    <div class="result-section-title">üü° Villite</div>
                    <div class="result-content" id="villite_output"></div>
                </div>

                <div class="result-section">
                    <div class="result-section-title">üü¢ Calcificazioni</div>
                    <div class="result-content" id="calcif_output"></div>
                </div>

                <div class="result-section" id="note_aggiuntive_result" style="display: none;">
                    <div class="result-section-title">Altre Osservazioni</div>
                    <div class="result-content" id="note_aggiuntive_output"></div>
                </div>

                <div class="conclusione-box">
                    <div style="font-weight: 700; margin-bottom: 0.8rem;">Conclusione e Indicazioni Cliniche:</div>
                    <div id="conclusione"></div>
                </div>
            </div>
        </div>

        <div class="footer">
            <strong>Riferimenti Bibliografici</strong><br>
            Benirschke K, Kaufmann P, Baergen RN. <em>Pathology of the Human Placenta</em>. 6th ed. Springer; 2012.<br>
            ISSHP (International Society for the Study of Hypertension in Pregnancy). Guidelines on insufficienza placentare e preeclampsia.<br>
            SIPat (Societ√† Italiana di Anatomia Patologica). Linee guida per refertazione istologica placentare.
        </div>
    </div>

    <script>
        function checkSpessore() {
            const spessore = parseInt(document.getElementById('spessore').value);
            const alert_div = document.getElementById('spessore_alert');
            
            if (spessore < 10) {
                alert_div.className = 'alert-box alert-danger';
                alert_div.innerHTML = 'üî¥ Atrofia - Possibile insufficienza placentare';
            } else if (spessore > 30) {
                alert_div.className = 'alert-box alert-warn';
                alert_div.innerHTML = '‚ö†Ô∏è Edema - Possibile sofferenza placentare';
            } else {
                alert_div.className = 'alert-box alert-ok';
                alert_div.innerHTML = '‚úì Normale (10-30 mm)';
            }
        }

        function checkPeso() {
            const ega = parseInt(document.getElementById('ega_clinica_sett').value);
            const peso = parseInt(document.getElementById('peso_placenta').value);
            const pesoAtteso = ega * 15 - 200;
            const percentuale = Math.round((peso / pesoAtteso) * 100);
            const alert_div = document.getElementById('peso_alert');
            
            if (percentuale < 80) {
                alert_div.className = 'alert-box alert-danger';
                alert_div.innerHTML = `üî¥ Ridotto - ${percentuale}% peso atteso (${pesoAtteso}g)`;
            } else if (percentuale > 120) {
                alert_div.className = 'alert-box alert-warn';
                alert_div.innerHTML = `‚ö†Ô∏è Aumentato - ${percentuale}% peso atteso (${pesoAtteso}g)`;
            } else {
                alert_div.className = 'alert-box alert-ok';
                alert_div.innerHTML = `‚úì Normale - ${percentuale}% peso atteso (${pesoAtteso}g)`;
            }
        }

        function checkCordone() {
            const cordone = parseInt(document.getElementById('lunghezza_cordone').value);
            const alert_div = document.getElementById('cordone_alert');
            
            if (cordone < 30) {
                alert_div.className = 'alert-box alert-danger';
                alert_div.innerHTML = 'üî¥ Corto - Rischio compressione/avvolgimento';
            } else if (cordone > 80) {
                alert_div.className = 'alert-box alert-warn';
                alert_div.innerHTML = '‚ö†Ô∏è Lungo - Rischio annodamento/volvolo';
            } else {
                alert_div.className = 'alert-box alert-ok';
                alert_div.innerHTML = '‚úì Normale (30-80 cm)';
            }
        }

        function toggleInfarti() {
            document.getElementById('infarti_dettagli').classList.toggle('active');
        }

        function toggleVillite() {
            document.getElementById('villite_dettagli').classList.toggle('active');
        }

        function toggleCalcif() {
            document.getElementById('calcif_dettagli').classList.toggle('active');
        }

        function genera_referto() {
            try {
                const ega_clinica = parseInt(document.getElementById('ega_clinica_sett').value);
                const peso_placenta = document.getElementById('peso_placenta').value;
                const spessore = document.getElementById('spessore').value;
                const lunghezza_cordone = document.getElementById('lunghezza_cordone').value;
                const aspetto_fetale = document.getElementById('aspetto_fetale').value;
                const colore_placenta = document.getElementById('colore_placenta').value;
                const aspetto_cordone = document.getElementById('aspetto_cordone').value;

                const ega_istologia = document.getElementById('ega_istologia').value;
                const villi_stato = document.getElementById('villi_stato').value;

                // MACROSCOPICO
                document.getElementById('macro_output').innerHTML = `
                    <strong>EGA:</strong> ${ega_clinica} settimane<br>
                    <strong>Peso:</strong> ${peso_placenta}g<br>
                    <strong>Spessore:</strong> ${spessore} mm<br>
                    <strong>Lunghezza cordone:</strong> ${lunghezza_cordone} cm<br>
                    <strong>Superficie fetale:</strong> ${aspetto_fetale}<br>
                    <strong>Colore:</strong> ${colore_placenta}<br>
                    <strong>Cordone ombelicale:</strong> ${aspetto_cordone}
                `;

                // PILASTRI
                let pilastri_html = '';
                if (ega_istologia === 'compatibile') {
                    pilastri_html += `<strong>‚úì ETA' GESTAZIONALE:</strong> <span class="status-yes">Compatibile</span> (${ega_clinica} sett.)<br>`;
                } else if (ega_istologia === 'precoce') {
                    pilastri_html += `<strong>‚ö† ETA' GESTAZIONALE:</strong> <span class="status-partial">Pi√π precoce</span> di quella indicata<br>`;
                } else if (ega_istologia === 'tardiva') {
                    pilastri_html += `<strong>‚ö† ETA' GESTAZIONALE:</strong> <span class="status-partial">Pi√π tardiva</span> di quella indicata<br>`;
                }

                if (villi_stato === 'maturi') {
                    pilastri_html += `<strong>‚úì VILLI CORIALI:</strong> <span class="status-yes">Maturi</span> - sincizio sottile, fenestrazioni presenti`;
                } else if (villi_stato === 'intermedi') {
                    pilastri_html += `<strong>‚ö† VILLI CORIALI:</strong> <span class="status-partial">Intermedi</span> - maturazione parziale`;
                } else if (villi_stato === 'immaturi') {
                    pilastri_html += `<strong>‚úó VILLI CORIALI:</strong> <span class="status-no">Immaturi</span> - ANOMALO per EGA ${ega_clinica} sett.`;
                } else if (villi_stato === 'degenerativi') {
                    pilastri_html += `<strong>‚úó VILLI CORIALI:</strong> <span class="status-no">Degenerativi</span> - Edema, danno sinciziale`;
                }

                document.getElementById('pilastri_output').innerHTML = pilastri_html;

                // INFARTI
                let infarti_presente = document.getElementById('infarti_presenti').checked;
                if (infarti_presente) {
                    const estensione = document.getElementById('infarti_estensione').value;
                    const localizzazione = document.getElementById('infarti_localizzazione').value;
                    const percentuale = document.getElementById('infarti_percentuale').value;
                    const note = document.getElementById('infarti_note').value;
                    document.getElementById('infarti_output').innerHTML = `<span class="status-no">PRESENTI</span><br><strong>Estensione:</strong> ${estensione} ‚Ä¢ <strong>Localizzazione:</strong> ${localizzazione} ‚Ä¢ <strong>% parenchima:</strong> ~${percentuale}%${note ? '<br><strong>Note:</strong> ' + note : ''}`;
                } else {
                    document.getElementById('infarti_output').innerHTML = `<span class="status-yes">Assenti</span>`;
                }

                // VILLITE
                let villite_presente = document.getElementById('villite_presenti').checked;
                if (villite_presente) {
                    const grado = document.getElementById('villite_grado').value;
                    const distribuzione = document.getElementById('villite_distribuzione').value;
                    const tipo = document.getElementById('villite_tipo').value;
                    const note = document.getElementById('villite_note').value;
                    document.getElementById('villite_output').innerHTML = `<span class="status-no">PRESENTE</span><br><strong>Grado:</strong> ${grado} ‚Ä¢ <strong>Distribuzione:</strong> ${distribuzione} ‚Ä¢ <strong>Infiltrato:</strong> ${tipo}${note ? '<br><strong>Interpretazione:</strong> ' + note : ''}`;
                } else {
                    document.getElementById('villite_output').innerHTML = `<span class="status-yes">Assente</span>`;
                }

                // CALCIFICAZIONI
                let calcif_presente = document.getElementById('calcif_presenti').checked;
                let calcif_patologica = false;
                if (calcif_presente) {
                    const distribuzione = document.getElementById('calcif_distribuzione').value;
                    const stadio = document.getElementById('calcif_stadio').value;
                    const aspetto = document.getElementById('calcif_aspetto').value;
                    const note = document.getElementById('calcif_note').value;
                    calcif_patologica = (stadio !== 'Scarsa');
                    const status = stadio === 'Scarsa' ? 'status-yes' : 'status-partial';
                    const label = stadio === 'Scarsa' ? 'SCARSE (fisiologiche)' : 'PRESENTI';
                    document.getElementById('calcif_output').innerHTML = `<span class="${status}">${label}</span><br><strong>Distribuzione:</strong> ${distribuzione} ‚Ä¢ <strong>Stadio:</strong> ${stadio} ‚Ä¢ <strong>Aspetto:</strong> ${aspetto}${note ? '<br><strong>Interpretazione:</strong> ' + note : ''}`;
                } else {
                    document.getElementById('calcif_output').innerHTML = `<span class="status-yes">Assenti</span>`;
                }

                // NOTE AGGIUNTIVE
                const note_aggiuntive = document.getElementById('note_aggiuntive').value;
                if (note_aggiuntive) {
                    document.getElementById('note_aggiuntive_result').style.display = 'block';
                    document.getElementById('note_aggiuntive_output').innerHTML = note_aggiuntive;
                } else {
                    document.getElementById('note_aggiuntive_result').style.display = 'none';
                }

                // CONCLUSIONE SEMPLIFICATA
                let conclusione = '';
                const no_lesioni = !infarti_presente && !villite_presente && !calcif_presente;
                const solo_calcif_scarsa = !infarti_presente && !villite_presente && calcif_presente && !calcif_patologica;

                if (no_lesioni && villi_stato === 'maturi' && ega_istologia === 'compatibile') {
                    conclusione = `Esame istologico senza alterazioni significative. Struttura e maturazione placentare pienamente compatibile con EGA clinica di ${ega_clinica} settimane. Villi maturi, assenza di lesioni patologiche, adeguata funzione placentare. Follow-up ostetrico standard.`;
                } else if (solo_calcif_scarsa && villi_stato === 'maturi') {
                    conclusione = `Calcificazioni scarse, completamente fisiologiche a termine. Marker di maturazione placentare normale. Nessun significato patologico. Follow-up clinico standard.`;
                } else if (infarti_presente && !villite_presente && !calcif_patologica) {
                    conclusione = `<strong>Insufficienza placentare cronica con infarti placentari.</strong> Workup consigliato: screening trombofilgia materna (fattore V Leiden, G20210A, proteina C/S), anticorpi antifosfolipidi, counseling ostetrico per gestioni future. Correlazione urgente con clinica ostetrica (pressione, oligoidramnios, ecografia).`;
                } else if (!infarti_presente && villite_presente && !calcif_patologica) {
                    conclusione = `<strong>URGENTE - Villite fortemente sospetta per infezione congenita.</strong> Workup STAT: serologica materna (CMV, toxo, sifilide, listeria, varicella, parvovirus), PCR liquor neonatale, ricerca patogeni. Follow-up pediatrico multidisciplinare urgente (neurologia, audiologia, oftalmologia). Alto rischio di sequele neonatali.`;
                } else if (!infarti_presente && !villite_presente && calcif_patologica) {
                    conclusione = `Calcificazioni patologiche suggestive di stress placentare cronico. Workup: escludere preeclampsia, ipertensione, IUGR. Screening trombofilgia se preeclampsia ricorrente. Counseling su rischio ricorrenza in gravidanze future.`;
                } else {
                    conclusione = `<strong>Alterazioni patologiche multiple significative.</strong> Danno placentare severo da meccanismi multipli. URGENTE: workup completo per infezione congenita, trombofilgia materna, anticorpi antifosfolipidi. Follow-up pediatrico multidisciplinare urgente. Alto rischio outcome perinatale sfavorevole.`;
                }

                document.getElementById('conclusione').innerHTML = conclusione;
                document.getElementById('result').classList.add('active');
                document.getElementById('result').scrollIntoView({ behavior: 'smooth', block: 'start' });

                checkSpessore();
                checkPeso();
                checkCordone();
            } catch (error) {
                alert('Errore: ' + error.message);
                console.error(error);
            }
        }
    </script>
</body>
</html>
